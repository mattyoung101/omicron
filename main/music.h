#pragma once
#include "driver/mcpwm.h"
#include "freertos/FreeRTOS.h"
#include "freertos/task.h"
#include "freertos/timers.h"
#include "defines.h"

typedef struct {
    /** true if note on, false if note off **/
    bool type : 1;
    /** frequency of note: 27.5 Hz to 4186 Hz, max: 8192 Hz **/
    uint16_t frequency : 13;
    /** time the note is on for in ms, max: 65536 ms **/
    uint16_t time : 16;
    /** pad to 32 bits **/
    char : 2;
} music_note_t;

/** A motor controller, which music will be played through **/
typedef struct {
    /** The current note playing on the motor controller or none **/
    music_note_t *currentNote;
} music_dev_t;

// Generated by midi_processor.py (original file: SoundTest.mid)
const music_note_t SONG_SOUNDTEST[248] = {{1, 261, 0}
, {1, 329, 600}, {1, 391, 600}, {1, 523, 600}, {0, 261, 600}, {0, 329, 0}, {0, 391, 0}, {0, 523, 0}
, {1, 261, 150}, {1, 329, 75}, {1, 391, 75}, {1, 523, 75}, {0, 261, 224}, {0, 329, 0}, {0, 391, 0}
, {0, 523, 0}, {1, 293, 600}, {1, 349, 600}, {1, 440, 600}, {1, 587, 600}, {0, 293, 600}, {0, 349, 0}
, {0, 440, 0}, {0, 587, 0}, {1, 293, 150}, {1, 349, 75}, {1, 440, 75}, {1, 587, 75}, {0, 293, 224}
, {0, 349, 0}, {0, 440, 0}, {0, 587, 0}, {1, 329, 600}, {1, 391, 600}, {1, 493, 600}, {1, 659, 600}
, {0, 329, 600}, {0, 391, 0}, {0, 493, 0}, {0, 659, 0}, {1, 329, 150}, {1, 391, 75}, {1, 493, 75}
, {1, 659, 75}, {0, 329, 224}, {0, 391, 0}, {0, 493, 0}, {0, 659, 0}, {1, 261, 600}, {0, 261, 150}
, {1, 329, 0}, {0, 329, 150}, {1, 391, 0}, {0, 391, 150}, {1, 261, 0}, {0, 261, 150}, {1, 329, 0}
, {0, 329, 150}, {1, 391, 0}, {0, 391, 150}, {1, 261, 0}, {0, 261, 150}, {1, 329, 0}, {0, 329, 150}
, {1, 391, 0}, {0, 391, 150}, {1, 261, 0}, {0, 261, 150}, {1, 329, 0}, {0, 329, 150}, {1, 391, 0}
, {0, 391, 150}, {1, 261, 0}, {0, 261, 150}, {1, 329, 0}, {0, 329, 150}, {1, 391, 0}, {0, 391, 150}
, {1, 261, 0}, {0, 261, 150}, {1, 293, 0}, {0, 293, 150}, {1, 349, 0}, {0, 349, 150}, {1, 440, 0}
, {0, 440, 150}, {1, 293, 0}, {0, 293, 150}, {1, 349, 0}, {0, 349, 150}, {1, 440, 0}, {0, 440, 150}
, {1, 293, 0}, {0, 293, 150}, {1, 349, 0}, {0, 349, 150}, {1, 440, 0}, {0, 440, 150}, {1, 293, 0}
, {0, 293, 150}, {1, 349, 0}, {0, 349, 150}, {1, 440, 0}, {0, 440, 150}, {1, 293, 0}, {0, 293, 150}
, {1, 349, 0}, {0, 349, 150}, {1, 440, 0}, {0, 440, 150}, {1, 293, 0}, {0, 293, 150}, {1, 329, 0}
, {0, 329, 150}, {1, 391, 0}, {0, 391, 150}, {1, 493, 0}, {0, 493, 150}, {1, 329, 0}, {0, 329, 150}
, {1, 391, 0}, {0, 391, 150}, {1, 493, 0}, {0, 493, 150}, {1, 329, 0}, {0, 329, 150}, {1, 391, 0}
, {0, 391, 150}, {1, 493, 0}, {0, 493, 150}, {1, 329, 0}, {0, 329, 150}, {1, 391, 0}, {0, 391, 150}
, {1, 493, 0}, {0, 493, 150}, {1, 329, 0}, {0, 329, 150}, {1, 391, 0}, {0, 391, 150}, {1, 493, 0}
, {0, 493, 150}, {1, 329, 0}, {0, 329, 150}, {1, 391, 0}, {0, 391, 150}, {1, 466, 0}, {0, 466, 150}
, {1, 587, 0}, {0, 587, 150}, {1, 391, 0}, {0, 391, 150}, {1, 466, 0}, {0, 466, 150}, {1, 587, 0}
, {0, 587, 150}, {1, 391, 0}, {0, 391, 150}, {1, 466, 0}, {0, 466, 150}, {1, 587, 0}, {0, 587, 150}
, {1, 391, 0}, {0, 391, 150}, {1, 466, 0}, {0, 466, 150}, {1, 587, 0}, {0, 587, 150}, {1, 391, 0}
, {0, 391, 150}, {1, 466, 0}, {0, 466, 150}, {1, 587, 0}, {0, 587, 150}, {1, 391, 0}, {0, 391, 150}
, {1, 32, 1200}, {0, 32, 300}, {1, 36, 0}, {0, 36, 300}, {1, 41, 0}, {0, 41, 300}, {1, 43, 0}
, {0, 43, 300}, {1, 48, 0}, {0, 48, 300}, {1, 55, 0}, {0, 55, 300}, {1, 61, 0}, {0, 61, 300}
, {1, 65, 0}, {0, 65, 300}, {1, 73, 0}, {0, 73, 300}, {1, 82, 0}, {0, 82, 300}, {1, 87, 0}
, {0, 87, 300}, {1, 97, 0}, {0, 97, 300}, {1, 110, 0}, {0, 110, 300}, {1, 123, 0}, {0, 123, 300}
, {1, 130, 0}, {0, 130, 300}, {1, 146, 0}, {0, 146, 300}, {1, 164, 0}, {0, 164, 300}, {1, 174, 0}
, {0, 174, 300}, {1, 195, 0}, {0, 195, 300}, {1, 220, 0}, {0, 220, 300}, {1, 246, 0}, {0, 246, 300}
, {1, 261, 0}, {0, 261, 300}, {1, 293, 0}, {0, 293, 300}, {1, 329, 0}, {0, 329, 300}, {1, 349, 0}
, {0, 349, 300}, {1, 391, 0}, {0, 391, 300}, {1, 440, 0}, {0, 440, 300}, {1, 493, 0}, {0, 493, 300}
, {1, 523, 0}, {0, 523, 300}, {1, 587, 0}, {0, 587, 300}, {1, 659, 0}, {0, 659, 300}, {1, 698, 0}
, {0, 698, 300}, {1, 783, 0}, {0, 783, 300}, {1, 880, 0}, {0, 880, 300}, {1, 987, 0}, {0, 987, 300}
, {1, 1046, 0}, {0, 1046, 1499}};

/** Starts a FreeRTOS task to play the specified song **/
void music_play(music_note_t *song);